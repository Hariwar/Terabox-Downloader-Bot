from requests import get as HTTP
from telegram import InlineKeyboardMarkup, InlineKeyboardButton
from urllib.parse import quote

bot.sendChatAction(chat_id=message.chat.id, action="typing")
ms = quote(message.text)Â  # Encode the URL

url = f"https://teraboxvideodownloader.nepcoderdevs.workers.dev/?url={ms}"

try:
Â Â Â  response = HTTP(url)
Â Â Â  if response.status_code == 200:
Â Â Â Â Â Â Â  data = response.json()

Â Â Â Â Â Â Â  resolutions = data["response"][0]["resolutions"]
Â Â Â Â Â Â Â  fast_download_link = resolutions["Fast Download"]
Â Â Â Â Â Â Â  hd_video_link = resolutions["HD Video"]
Â Â Â Â Â Â Â  thumbnail_url = data["response"][0]["thumbnail"]
Â Â Â Â Â Â Â  video_title = data["response"][0]["title"]

Â Â Â Â Â Â Â  tinyurl_api = "http://tinyurl.com/api-create.php?url="
Â Â Â Â Â Â Â  tinyurl_fast_download = tinyurl_api + fast_download_link
Â Â Â Â Â Â Â  tinyurl_hd_video = tinyurl_api + hd_video_link
Â Â Â Â Â Â Â  shortened_fast_download_link = HTTP(tinyurl_fast_download).text
Â Â Â Â Â Â Â  shortened_hd_video_link = HTTP(tinyurl_hd_video).text

Â Â Â Â Â Â Â  markup = InlineKeyboardMarkup()
Â Â Â Â Â Â Â  markup.row(
Â Â Â Â Â Â Â Â Â Â Â  InlineKeyboardButton(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  text='â¡ï¸ Fast Download',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  url=shortened_fast_download_link
Â Â Â Â Â Â Â Â Â Â Â  ),
Â Â Â Â Â Â Â Â Â Â Â  InlineKeyboardButton(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  text='â–¶ï¸ HD Video',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  url=shortened_hd_video_link
Â Â Â Â Â Â Â Â Â Â Â  )
Â Â Â Â Â Â Â  )
Â Â Â Â Â Â Â  markup.row(
Â Â Â Â Â Â Â Â Â Â Â  InlineKeyboardButton(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  text='Developer',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  url='t.me/mtp_bots'
Â Â Â Â Â Â Â Â Â Â Â  )
Â Â Â Â Â Â Â  )

Â Â Â Â Â Â Â  message_text = f"ğŸ¬ <b>Title:</b> {video_title}\nMade with â¤ï¸ by @mtp_bots"

Â Â Â Â Â Â Â  bot.sendPhoto(
Â Â Â Â Â Â Â Â Â Â Â  chat_id=message.chat.id,
Â Â Â Â Â Â Â Â Â Â Â  photo=thumbnail_url,
Â Â Â Â Â Â Â Â Â Â Â  caption=message_text,
Â Â Â Â Â Â Â Â Â Â Â  parse_mode="HTML",
Â Â Â Â Â Â Â Â Â Â Â  reply_markup=markup
Â Â Â Â Â Â Â  )
Â Â Â  else:
Â Â Â Â Â Â Â  bot.sendMessage(
Â Â Â Â Â Â Â Â Â Â Â  chat_id=message.chat.id,
Â Â Â Â Â Â Â Â Â Â Â  text="âŒ <b>Error fetching data from Terabox API</b>",
Â Â Â Â Â Â Â Â Â Â Â  parse_mode="HTML"
Â Â Â Â Â Â Â  )
except Exception as e:
Â Â Â  bot.sendMessage(
Â Â Â Â Â Â Â  chat_id=message.chat.id,
Â Â Â Â Â Â Â  text=f"âŒ <b>Error: {str(e)}</b>",
Â Â Â Â Â Â Â  parse_mode="HTML"
Â Â Â  )
